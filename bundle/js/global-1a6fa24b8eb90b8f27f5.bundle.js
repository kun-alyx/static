"use strict";(self.webpackChunkkemono_2_client=self.webpackChunkkemono_2_client||[]).push([[172],{258:(e,t,n)=>{n.d(t,{J:()=>l});var o=n(744),a=n(8745);async function r(e,t){try{const s=await fetch(e,t);if(401===s.status){if(a.j)return localStorage.removeItem("logged_in"),localStorage.removeItem("role"),localStorage.removeItem("favs"),localStorage.removeItem("post_favs"),void(location.href="/account/logout");const e=new URL("/account/login",location.origin).toString();return void(location=(n=e,"location",o=location.pathname,r=new URL(n),r.searchParams.set("location",o),r.toString()))}return s}catch(e){console.error(`Kemono request error: ${e}`)}var n,o,r}const s={retrieveFavoriteArtists:async function(){const e=new URLSearchParams([["type","artist"]]).toString();try{const t=await r(`/api/v1/account/favorites?${e}`);if(!t||!t.ok)throw new Error(`Error ${t.status}: ${t.statusText}`);return await t.text()}catch(e){console.error(e)}},favoriteArtist:async function(e,t){try{const n=await r(`/api/v1/favorites/creator/${e}/${t}`,{method:"POST"});return!(!n||!n.ok)||(alert(new o.sf(3)),!1)}catch(e){console.error(e)}},unfavoriteArtist:async function(e,t){try{const n=await r(`/api/v1/favorites/creator/${e}/${t}`,{method:"DELETE"});return!(!n||!n.ok)||(alert(new o.sf(4)),!1)}catch(e){console.error(e)}},retrieveFavoritePosts:async function(){const e=new URLSearchParams([["type","post"]]).toString();try{const t=await r(`/api/v1/account/favorites?${e}`);if(!t||!t.ok)throw new Error(`Error ${t.status}: ${t.statusText}`);const n=(await t.json()).map((e=>({id:e.id,service:e.service,user:e.user})));return JSON.stringify(n)}catch(e){console.error(e)}},favoritePost:async function(e,t,n){try{const a=await r(`/api/v1/favorites/post/${e}/${t}/${n}`,{method:"POST"});return!(!a||!a.ok)||(alert(new o.sf(1)),!1)}catch(e){console.error(e)}},unfavoritePost:async function(e,t,n){try{const a=await r(`/api/v1/favorites/post/${e}/${t}/${n}`,{method:"DELETE"});return!(!a||!a.ok)||(alert(new o.sf(2)),!1)}catch(e){console.error(e)}}},i={attemptFlag:async function(e,t,n){try{const a=await r(`/api/v1/${e}/user/${t}/post/${n}/flag`,{method:"POST"});return!(!a||!a.ok)||(alert(new o.sf(5)),!1)}catch(e){console.error(e)}}};var c=n(3374);const l={favorites:s,posts:i,api:{bans:async function(){try{const e=await r("/api/v1/creators/bans",{method:"GET"});return e&&e.ok?await e.json():(alert(new o.sf(6)),null)}catch(e){console.error(e)}},bannedArtist:async function(e,t){const n=new URLSearchParams([["service",t]]).toString();try{const t=await r(`/api/v1/lookup/cache/${e}?${n}`);return t&&t.ok?await t.json():(alert(new o.sf(7)),null)}catch(e){console.error(e)}},creators:async function(){try{const e=await r(c.Dp||"/api/v1/creators",{method:"GET"});return e&&e.ok?await e.json():(alert(new o.sf(8)),null)}catch(e){console.error(e)}},logs:async function(e){try{const t=await r(`/api/v1/importer/logs/${e}`,{method:"GET"});return t&&t.ok?await t.json():(alert(new o.sf(9)),null)}catch(e){console.error(e)}}},dms:{retrieveHasPendingDMs:async function(){try{const e=await r("/api/v1/has_pending_dms");if(!e||!e.ok)throw new Error(`Error ${e.status}: ${e.statusText}`);return await e.json()}catch(e){console.error(e)}}}}},3374:(e,t,n)=>{n.d(t,{Dp:()=>r,Kq:()=>a,QA:()=>o});const o="//img.kemono.su",a="//img.kemono.su",r="/api/v1/creators.txt"},8745:(e,t,n)=>{n.d(t,{j:()=>o});const o="yes"===localStorage.getItem("logged_in")},1823:(e,t,n)=>{n.d(t,{H:()=>a,L:()=>r});const o=new Map;function a(e){const t=e.querySelector(".component-container");t.querySelectorAll(`#${t.id} > *`).forEach((e=>{o.set(e.className.trim(),e)})),t.remove()}function r(e){const t=o.get(e);return t?t.cloneNode(!0):console.error(`Component "${e}" doesn't exist.`)}},8359:(e,t,n)=>{n.d(t,{FL:()=>l,K_:()=>c,VH:()=>a,dC:()=>s,iJ:()=>i,t8:()=>r,w8:()=>d});var o=n(258);async function a(){let e=localStorage.getItem("favs"),t=localStorage.getItem("post_favs");if(!e||"undefined"===e){const e=await o.J.favorites.retrieveFavoriteArtists();e&&localStorage.setItem("favs",e)}if(!t||"undefined"===t){const e=await o.J.favorites.retrieveFavoritePosts();e&&localStorage.setItem("post_favs",e)}}async function r(e,t){let n;try{n=JSON.parse(localStorage.getItem("favs"))}catch(n){if(n instanceof SyntaxError){const n=await async function(){try{const e=await o.J.favorites.retrieveFavoriteArtists();return e?(localStorage.setItem("favs",e),!0):(alert("Could not retrieve favorite artists"),!1)}catch(e){console.error(e)}}();if(!n)return;return await r(e,t)}}if(n)return n.find((n=>n.id===e&&n.service===t))}async function s(e,t,n){let a;try{if(a=JSON.parse(localStorage.getItem("post_favs")),!a)return;return a.find((o=>o.id===n&&o.service===e&&o.user===t))}catch(a){if(a instanceof SyntaxError){const a=await async function(){try{const e=await o.J.favorites.retrieveFavoritePosts();return e?(localStorage.setItem("post_favs",e),!0):(alert("Could not retrieve favorite posts"),!1)}catch(e){console.error(e)}}();if(!a)return;return await s(e,t,n)}}}async function i(e,t){if(!await o.J.favorites.favoriteArtist(t,e))return!1;const n=await o.J.favorites.retrieveFavoriteArtists();return localStorage.setItem("favs",n),!0}async function c(e,t){if(!await o.J.favorites.unfavoriteArtist(t,e))return!1;const n=await o.J.favorites.retrieveFavoriteArtists();return localStorage.setItem("favs",n),!0}async function l(e,t,n){if(!await o.J.favorites.favoritePost(e,t,n))return!1;const a=await o.J.favorites.retrieveFavoritePosts();return localStorage.setItem("post_favs",a),!0}async function d(e,t,n){if(!await o.J.favorites.unfavoritePost(e,t,n))return!1;const a=await o.J.favorites.retrieveFavoritePosts();return localStorage.setItem("post_favs",a),!0}},4558:(e,t,n)=>{n(2406),n(5948),n(8842),n(7147);var o=n(8745),a=n(8359),r=n(744),s=n(2490),i=n(6295),c=n(435);o.j&&((0,a.VH)(),(0,c.s)()),(0,r._K)(document.images),(0,i.i)(s.De)},6295:(e,t,n)=>{n.d(t,{i:()=>r});var o=n(3027),a=n(1823);function r(e){const t=document.querySelector(".global-sidebar"),n=document.querySelector("main"),r=document.querySelector(".global-footer"),s=n.querySelectorAll("main > .site-section");(0,a.H)(r),(0,o.Jd)(t),s.forEach((t=>{const n=t.className.match(/site-section--([a-z\-]+)/gi);n&&n.length>0&&n.forEach((n=>{n=n.replace("site-section--",""),e.has(n)&&e.get(n).forEach((e=>{e(t)}))}))}))}},435:(e,t,n)=>{n.d(t,{s:()=>a});var o=n(258);async function a(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n="true"===localStorage.getItem("has_pending_review_dms"),a=parseInt(localStorage.getItem("last_checked_has_pending_review_dms"));(e||!a||a<Date.now()-60*t*1e3)&&(n=await o.J.dms.retrieveHasPendingDMs(),localStorage.setItem("has_pending_review_dms",n.toString()),localStorage.setItem("last_checked_has_pending_review_dms",Date.now().toString())),document.querySelector(".review_dms > img").src=n?"/static/menu/red_dm.svg":"/static/menu/dm.svg"}},2490:(e,t,n)=>{n.d(t,{t9:()=>Q,De:()=>Y});var o=n(8359),a=n(3027),r=n(1823),s=n(8745),i=n(258);let c,l,d=parseInt(window.location.hash.substring(1).split("&").find((e=>"o"===e.split("=")[0]))?.split("=")[1])||0,u=50;const m=5,f=m-2,v=m-f;function p(e){var t=this;let n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];clearTimeout(n),n=setTimeout((()=>{e.apply(t,r)}),o)}}function g(e,t,n,o,a,r,s){return async i=>{y(e.value,t.value,n.value,o.value),await L(a,r,s,n.value)}}function h(e,t){return e<t?-1:e>t?1:0}function y(e,t,n,o){l=c.slice(0),"desc"===e&&l.reverse(),l=l.filter((e=>e.service===(t||e.service))).sort(((t,o)=>"asc"===e?"indexed"===n?t.parsedIndexed-o.parsedIndexed:"updated"===n?t.parsedUpdated-o.parsedUpdated:h(t[n],o[n]):"indexed"===n?o.parsedIndexed-t.parsedIndexed:"updated"===n?o.parsedUpdated-t.parsedUpdated:h(o[n],t[n]))).filter((e=>e.name.match(new RegExp(o.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i"))))}function w(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"string"==typeof t&&(n=t,t=null),"number"==typeof t?`<a href="#" class="${n||""} paginator-button-ident" data-value="${t}"><b>${e}</b></a>`:`<li class="${n||""} paginator-button-ident"><b>${e}</b></li>`}function _(){const e=l.length,t=d+u<e?d+u:e,n=Math.ceil((d+u)/u),o=Math.ceil(e/u),a=o<m||n<m?n-1:o-n<m?m-1+(m-(o-n)):m-1,r=Math.max(n-a-1,1),s=r>1,i=o-n>m+(n-r<m?m-(n-r):0),c=n-v-(o-n<v?v-(o-n):0),p=n+v+(n-r<v?v-(n-r):0),g=function(e,t){const n=t-0;return Array.from({length:n},((e,t)=>0+t))}(0,2*m+1);return e>u?`\n    <small>Showing ${d+1} - ${t} of ${e}</small>\n    <menu>\n\n    ${s||i?w("<<",s?0:"pagination-button-disabled"+(n-v-1?" pagination-desktop":"")):""}\n    ${s?"":n-v-1?w("<<",0,"pagination-mobile"):o-n>v&&!i?w("<<","pagination-button-disabled pagination-mobile"):""}\n    ${n>1?w("<",(n-2)*u,"prev"):w("<","pagination-button-disabled")}\n    ${g.map((e=>e+r&&e+r<=o?w(e+r,e+r!=n?(e+r-1)*u:null,(e+r<c||e+r>p)&&e+r!=n?"pagination-button-optional":e+r==n?"pagination-button-disabled pagination-button-current":e+r==n+1?"pagination-button-after-current":""):"")).join("\n")}\n    ${n<o?w(">",n*u,"next"):w(">","pagination-button-disabled"+(o?" pagination-button-after-current":""))}\n    ${s||i?w(">>",i?(o-1)*u:"pagination-button-disabled"+(o-n>v?" pagination-desktop":"")):""}\n    ${i?"":o-n>v?w(">>",(o-1)*u,"pagination-mobile"):n>f&&!s?w(">>","pagination-button-disabled pagination-mobile"):""}\n    </menu>\n  `:""}async function L(e,t,n,r){e.textContent="Displaying search results",n.top.innerHTML=_(),n.bottom.innerHTML=_();const[...i]=t.children;if(i.forEach((e=>{e.remove()})),0===l.length){const e=document.createElement("p");return e.classList.add("subtitle","card-list__item--no-results"),e.textContent="No artists found for your query.",void t.appendChild(e)}{const e=document.createDocumentFragment();for await(const t of l.slice(d,d+u)){const n="favorited"===r,i="indexed"===r,c="updated"===r,l=(0,a.Oe)(null,t,n,c,i);s.j&&await(0,o.t8)(t.id,t.service)&&l.classList.add("user-card--fav"),e.appendChild(l)}t.appendChild(e)}}var E=n(744),S=n(3374);let b;function I(){let e=document.getElementById("reason");e.value.length>140?(e.title="Too long (140 max)",e.classList.add("invalid")):(e.title="",e.classList.remove("invalid"))}async function C(){void 0===b&&(b=await i.J.api.creators());const e=document.querySelector("meta[name='id']").content,t=document.querySelector("meta[name='service']").content;let n=document.getElementById("service").value,o=document.getElementById("creator_name").value.toLowerCase(),a=document.getElementById("submit"),r=document.getElementById("lookup-result");a.disabled=!0;let s=b.filter((a=>(console.log(a),!(a.service===t&&a.id===e)&&(!o||a.name.toLowerCase().includes(o))&&("all"===n||a.service===n)))).slice(0,20).map(k);console.log(s),r.replaceChildren.apply(r,s)}function k(e){let t,{id:n,name:o,service:a,indexed:r,updated:s,favorited:i}=e;(s||r)&&(t=new Date(1e3*(s||r)).toISOString());let c=E.VY.kemono.user.icon(a,n),l=E.VY.kemono.user.banner(a,n);c=S.QA+c,l=S.Kq+l;let d=document.createElement("div");return d.innerHTML=`\n  <a href="/${a}/user/${n}" class="user-card" style="background-image: linear-gradient(rgb(0 0 0 / 50%), rgb(0 0 0 / 80%)), url(&quot;${l}&quot;)">\n    <div class="user-card__icon">\n      <div class="user-card__user-icon">\n        <span class="fancy-image">\n          <picture class="fancy-image__picture">\n            <img class="fancy-image__image" src="${c}" srcset="${c}" loading="lazy" alt="">\n          </picture>\n        </span>\n      </div>\n    </div>\n\n    <div class="user-card__info">\n      <div class="user-card__service" style="background-color: ${E.Wq[a].color}">\n        ${E.Wq[a].title}\n      </div>\n\n      <div class="user-card__name">\n        ${o}\n      </div>\n\n      <div class="user-card__updated">\n        <time class="timestamp" datetime="${t}">\n          ${t}\n        </time>\n      </div>\n    </div>\n  </a>\n  `,d.addEventListener("click",(e=>{e.preventDefault(),Array.from(document.querySelectorAll(".user-card.selected")).forEach((e=>e.classList.remove("selected"))),d.children[0].classList.add("selected"),document.querySelector("#new_link_form #creator").value=`${a}/${n}`,document.querySelector("#new_link_form #submit").disabled=!1})),d}var q=n(9650),x=(n(9295),n(9418),n(9497));const $={service:null,user:null,postID:null};function A(e,t){if(!e.naturalWidth)return setTimeout(A,10,e,t);e.style.maxWidth="100%",e.style.display="",t.style.display="none",t.style.opacity=""}function D(e){var t=e.target;if(t.parentNode.classList.contains("fileThumb"))if(e.preventDefault(),t.hasAttribute("data-src")){var n=document.createElement("img");n.setAttribute("src",t.parentNode.getAttribute("href")),n.style.display="none",t.parentNode.insertBefore(n,t.nextElementSibling),t.style.opacity="0.75",setTimeout(A,10,n,t)}else{var o=t.parentNode;o.firstChild.style.display="",o.removeChild(t),o.offsetTop<window.pageYOffset&&o.scrollIntoView({top:0,behavior:"smooth"})}}function B(){let e=document.querySelector("#post-tags > div");if(document.getElementById("show-tag-overflow-button")&&document.getElementById("show-tag-overflow-button").remove(),e&&e.offsetWidth<e.scrollWidth){let t=document.createElement("a");t.href="javascript:void 0",t.id="show-tag-overflow-button",t.textContent="Show all »",t.onclick=n=>{e.classList.contains("show-overflow")?(e.classList.remove("show-overflow"),t.textContent="Show all»"):(e.classList.add("show-overflow"),t.textContent="« Hide")},e.parentElement.appendChild(t)}}function T(e){return t=>{if("service"===t.target.id){t.stopPropagation();const n=t.target.value;e(n)}}}function F(e,t){let n=t[e];Object.values(t).forEach((e=>e.classList.add("form__section--hidden"))),Object.values(t).forEach((e=>e.querySelectorAll("input").forEach((e=>e.required=!1)))),n&&(n.classList.remove("form__section--hidden"),n.querySelectorAll("input").forEach((e=>e.required=!0)))}function P(e,t){Object.values(t).forEach((e=>e.hidden=!0)),t[e]?t[e].hidden=!1:t.other.hidden=!1}function J(e,t,n){t[e]?(n.classList.remove("form__section--hidden"),n.querySelector("input").checked=!0):(n.classList.add("form__section--hidden"),n.querySelector("input").checked=!1)}function j(e,t){"fanbox"===e?(t.classList.remove("form__section--hidden"),t.querySelector("input").checked=!1):(t.classList.add("form__section--hidden"),t.querySelector("input").checked=!1)}var O=n(435);async function N(e,t,n){let o=await i.J.api.logs(n.importID);if(!o)return 5===n.retries?void(n.status.textContent="Fatal Error"):(await(0,E.Q5)(n.cooldown),n.retries++,await N(e,t,n));const a=o.length-e.length;if(0===a)return n.cooldown=2*n.cooldown,await(0,E.Q5)(n.cooldown),(0,O.s)(!1,1).then((()=>{})),await N(e,t,n);const r=o.slice(o.length-a),s=document.createDocumentFragment();return r.forEach((e=>{const t=H(e);s.appendChild(t)})),e.push(...r),t.appendChild(s),n.count.textContent=e.length,await(0,E.Q5)(n.cooldown),await N(e,t,n)}function H(e){const t=(0,r.L)("log-list__item");return t.textContent=e,t}function U(e){const t=e.querySelector(".card-list");if(!t)return;const{cardList:n,cardItems:r}=(0,a.CS)(t);r.forEach((async e=>{(0,a.gH)();const{postID:t,userID:n,service:r}=(0,a.y4)(e),i=s.j&&await(0,o.dC)(r,n,t),c=s.j&&await(0,o.t8)(n,r);if(i&&e.classList.add("post-card--fav"),c){const t=e.querySelector(".post-card__header"),n=e.querySelector(".post-card__footer");t.classList.add("post-card__header--fav"),n.classList.add("post-card__footer--fav")}}))}var M=n(6880),R=n(8576),W=n(8386),z=n(2321);n(8957),n(6815);var V=n(7882),K=n.n(V);const Q=new Map,Y=(new Map,new Map([["user",[async function(e){(0,a.gH)();const t=document.head.querySelector("[name='id']")?.content,n=document.head.querySelector("[name='service']")?.content,i=e.querySelector(".user-header__actions"),c=e.querySelector(".card-list");document.styleSheets[0].insertRule(".post-card__footer > div > img { display: none; }",0),await async function(e,t,n){const i=(0,r.L)("user-header__favourite");if(!i)return;const c=await(0,o.t8)(t,n);if(localStorage.getItem("logged_in")&&c){i.classList.add("user-header__favourite--unfav");const[e,t]=i.children;e.textContent="★",t.textContent="Unfavorite"}var l,d;i.addEventListener("click",(l=t,d=n,async e=>{const t=e.target;if(!s.j)return void(0,a.hJ)(t,(0,a.F7)(null,"Favoriting"));const[n,i]=t.children,c=(0,r.L)("loading-icon");t.disabled=!0,t.classList.add("user-header__favourite--loading"),t.insertBefore(c,i);try{t.classList.contains("user-header__favourite--unfav")?await(0,o.K_)(l,d)&&(t.classList.remove("user-header__favourite--unfav"),n.textContent="☆",i.textContent="Favorite"):await(0,o.iJ)(l,d)&&(t.classList.add("user-header__favourite--unfav"),n.textContent="★",i.textContent="Unfavorite")}catch(e){console.error(e)}finally{c.remove(),t.disabled=!1,t.classList.remove("user-header__favourite--loading")}})),e?.appendChild(i)}(i,t,n);const l=document.location.pathname;l.includes("fancards")||l.includes("tags")||c&&await async function(e){const{cardItems:t}=(0,a.CS)(e);t.forEach((async e=>{const{postID:t,userID:n,service:r}=(0,a.y4)(e);s.j&&await(0,o.dC)(r,n,t)&&e.classList.add("post-card--fav")}))}(c)}]],["register",[function(e){!function(){var e=document.getElementById("serialized-favorites"),t=localStorage.getItem("favorites"),n=[];if(e&&t){t.split(",").forEach((function(e){var t=e.split(":");if(2==t.length){var o={service:t[0],artist_id:t[1]};n.push(o)}}));var o=JSON.stringify(n);e.value=o}}(),function(){const e=()=>document.getElementById("new-username"),t=()=>document.getElementById("new-password"),n=()=>document.getElementById("password-confirm"),o=()=>document.getElementById("username-char-count"),a=()=>document.getElementById("username-allowed-characters"),r=()=>document.getElementById("password-char-count"),s=()=>document.getElementById("password-confirm-matches"),i=new RegExp("^"+document.getElementById("register_form").dataset.pattern+"$"),c=new RegExp("[^a-z0-9_@+.-]","g");function l(c){let l=!1,d=e().value,u=t().value,m=n().value;d.length<3||d.length>15?(l=!0,o().classList.add("invalid")):o().classList.remove("invalid"),d.match(i)?a().classList.remove("invalid"):(l=!0,a().classList.add("invalid")),u.length<5?(l=!0,r().classList.add("invalid")):r().classList.remove("invalid"),m!==u||""===m?(l=!0,s().classList.add("invalid")):s().classList.remove("invalid"),document.getElementById("submit").disabled=l}window.addEventListener("load",(o=>{e().textContent=e().textContent.toLowerCase().replace(c,""),l(),e().addEventListener("input",l),e().addEventListener("input",(e=>{e.target.value=e.target.value.toLowerCase().replace(c,"")})),t().addEventListener("input",l),n().addEventListener("input",l)}))}()}]],["change-password",[function(){let e=()=>document.getElementById("current-password"),t=()=>document.getElementById("new-password"),n=()=>document.getElementById("new-password-confirmation"),o=()=>document.getElementById("password-char-count"),a=()=>document.getElementById("new-password-char-count"),r=()=>document.getElementById("password-confirm-matches");function s(s){let i=e().value,c=t().value,l=n().value,d=!1;i.length<5?(d=!0,o().classList.add("invalid")):o().classList.remove("invalid"),c.length<5?(d=!0,a().classList.add("invalid")):a().classList.remove("invalid"),c!=l||c.length<5?(d=!0,r().classList.add("invalid")):r().classList.remove("invalid"),document.getElementById("submit").disabled=d}s(),e().addEventListener("input",s),t().addEventListener("input",s),n().addEventListener("input",s)}]],["linked-account",[function(){"administrator"===localStorage.getItem("role")&&window.addEventListener("DOMContentLoaded",(e=>{Array.from(document.querySelectorAll(".user-card")).forEach((e=>{let t=document.createElement("button");t.textContent="✗",t.classList="remove-link",t.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation();let n=e.dataset.id,o=e.dataset.service;confirm(`Delete the connection for user #${n} on ${o}?`)&&(await async function(e,t){return 204==(await fetch(`/${e}/user/${t}/links`,{method:"DELETE"})).status}(o,n)?e.remove():alert("Error"))})),e.appendChild(t)}))}))}]],["new-linked-account",[function(){document.getElementById("service").addEventListener("input",p(C,300)),document.getElementById("creator_name").addEventListener("input",p(C,300)),document.getElementById("reason").addEventListener("input",p(I,300)),C()}]],["post",[async function(e){const t=e.querySelector(".post__actions");$.service=document.head.querySelector("[name='service']").content,$.user=document.head.querySelector("[name='user']").content,$.postID=document.head.querySelector("[name='id']").content;const n=e.querySelector(".post__body");e.addEventListener("click",D),function(e){const t=e.querySelector(".post__content");if(!t||!t.childElementCount&&!t.childNodes.length)return;if("fanbox"===$.service){if(!t.childElementCount&&1===t.childNodes.length){const[e]=Array.from(t.childNodes),n=document.createElement("pre");e.after(n),n.appendChild(e)}t.querySelectorAll("p").forEach((e=>{1===e.childElementCount&&"BR"===e.firstElementChild.tagName&&e.remove()}))}Array.from(document.links).forEach((e=>{const t=e.hostname;if(t.includes("downloads.fanbox.cc"))if(e.classList.contains("image-link"))e.remove();else{let t=document.createElement("span");t.textContent=e.textContent,e.replaceWith(t)}else t.includes("fanbox.cc")?e.href=e.href.replace(/https?:\/\/(?:[a-zA-Z0-9-]*.)?fanbox\.cc\/(?:(?:manage\/)|(?:@[a-zA-Z\d]+\/)|)posts\/(\d+)/g,"/fanbox/post/$1"):t.includes("patreon.com")&&(e.href=e.href.replace(/https?:\/\/(?:[\w-]*.)?patreon\.com\/posts\/.*\b(\d+)\b(?:\?.*)?/g,"/patreon/post/$1"))}));const n=t.querySelectorAll("p:empty");Array.from(n).forEach((e=>{e.nextElementSibling&&"BR"===e.nextElementSibling.tagName?(e.nextElementSibling.remove(),e.remove()):e.remove()}))}(n),await async function(e){const t=e.querySelector(".post__flag"),n=(0,r.L)("post__fav");if(s.j&&await(0,o.dC)($.service,$.user,$.postID)){const[e,t]=n.children;n.classList.add("post__fav--unfav"),e.textContent="★",t.textContent="Unfavorite"}var c,l,d;t.classList.contains("post__flag--flagged")||t.addEventListener("click",(c=$.service,l=$.user,d=$.postID,async e=>{const t=e.target,[n,o]=t.children,s=(0,a.Ho)(),u=confirm("Are you sure you want to flag this post for reimport? Only do this if data in the post is broken/corrupted/incomplete.\nThis is not a deletion button.");t.classList.add("post__flag--loading"),t.disabled=!0,t.insertBefore(s,o);try{if(u&&await i.J.posts.attemptFlag(c,l,d)){const e=t.parentElement,n=(0,r.L)("post__flag post__flag--flagged");e.insertBefore(n,t),t.remove()}}catch(e){console.error(e)}finally{s.remove(),t.disabled=!1,t.classList.remove("post__flag--loading")}})),n.addEventListener("click",function(e,t,n){return async r=>{const s=r.currentTarget;if("yes"!==localStorage.getItem("logged_in"))return void(0,a.hJ)(s,(0,a.F7)(null,"Favoriting"));const[i,c]=s.children,l=(0,a.Ho)();s.disabled=!0,s.classList.add("post__fav--loading"),s.insertBefore(l,c);try{s.classList.contains("post__fav--unfav")?await(0,o.w8)(e,t,n)&&(s.classList.remove("post__fav--unfav"),i.textContent="☆",c.textContent="Favorite"):await(0,o.FL)(e,t,n)&&(s.classList.add("post__fav--unfav"),i.textContent="★",c.textContent="Unfavorite")}catch(e){console.error(e)}finally{l.remove(),s.disabled=!1,s.classList.remove("post__fav--loading")}}}($.service,$.user,$.postID)),e.appendChild(n),document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowLeft":document.querySelector(".post__nav-link.prev")?.click();break;case"ArrowRight":document.querySelector(".post__nav-link.next")?.click()}}))}(t),function(){let e=document.getElementById("post-revision-selection");e&&e.addEventListener("change",(e=>{let t=e.target.selectedOptions[0].value;location.pathname=t?`/${$.service}/user/${$.user}/post/${$.postID}/revision/${t}`:`/${$.service}/user/${$.user}/post/${$.postID}`}))}(),document.addEventListener("DOMContentLoaded",((e,t)=>{B()})),window.addEventListener("resize",((e,t)=>{B()})),q.Z.init(),Array.from(document.getElementsByTagName("video")).forEach(((e,t)=>{(0,x.Z)(`kemono-player${t}`,{layoutControls:{fillToContainer:!1,preload:"none"},vastOptions:{adList:window.videoAds,adTextPosition:"top left",maxAllowedVastTagRedirects:2,vastAdvanced:{vastLoadedCallback:function(){},noVastVideoCallback:function(){},vastVideoSkippedCallback:function(){},vastVideoEndedCallback:function(){}}}})}))}]],["importer",[function(e){const t="yes"===localStorage.getItem("logged_in"),n=document.forms["import-list"],o=n.querySelector("#service").value,r={fansly:n.querySelector(".fansly__notes"),onlyfans:n.querySelector(".onlyfans__notes"),fanbox:n.querySelector(".fanbox__notes"),candfans:n.querySelector(".candfans__notes"),other:n.querySelector(".other__notes")};P(o,r),n.addEventListener("change",T((e=>P(e,r))));const s={discord:n.querySelector("#discord-section"),onlyfans:n.querySelector("#onlyfans-section")};F(o,s),n.addEventListener("change",T((e=>F(e,s))));const i={patreon:!0,fansly:!0};J(o,i,n.querySelector("#dm-consent")),n.addEventListener("change",T((e=>J(e,i,n.querySelector("#dm-consent"))))),j(o,n.querySelector("#fanbox-test-consent")),n.addEventListener("change",T((e=>j(e,n.querySelector("#fanbox-test-consent"))))),n.addEventListener("submit",function(e){return t=>{const n=t.target,o=n.elements["save-dms"],r=n.elements["fanbox-test-consent"],s=n.elements.service;"patreon"===s.value&&o.checked&&!e&&(t.preventDefault(),(0,a.hJ)(o,(0,a.F7)(null))),console.log(!r.checked),console.log(s.value),"fanbox"!==s.value||r.checked||(t.preventDefault(),(0,a.hJ)(r,(0,a.F7)("You need to agree.")))}}(t)),document.getElementById("user-agent").value=navigator.userAgent}]],["importer-status",[async function(e){const t=e.querySelector(".import__info"),[n,o]=t.children,[a,r]=n.children,s={importID:document.head.querySelector("meta[name='import_id']").content,status:a.children[1],count:r.children[1],cooldown:5e3,retries:0},c=e.querySelector(".loading-placeholder"),l=e.querySelector(".log-list");!function(e,t){const[n]=e.children;n.addEventListener("click",function(e){return t=>{e.classList.toggle("log-list--reversed")}}(t))}(o,l);const d=await i.J.api.logs(s.importID);d?(function(e,t,n){const o=document.createDocumentFragment();e.forEach((e=>{const t=H(e);o.appendChild(t)})),n.classList.add("loading-placeholder--complete"),t.appendChild(o),t.classList.add("log-list--loaded")}(d,l,c),s.status.textContent="In Progress",s.count.textContent=d.length,r.classList.remove("import__count--invisible"),(0,O.s)(!0).then((()=>{})),await(0,E.Q5)(s.cooldown),await N(d,l,s)):(c.classList.add("loading-placeholder--complete"),alert("Failed to fetch the logs, try reloading the page."))}]],["posts",[U]],["popular-posts",[U]],["artists",[async function(e){const t=document.getElementById("display-status"),n=document.getElementById("loading"),r=document.forms["search-form"],u=r.elements.order,m=r.elements.service,f=r.elements.sort_by,v=r.elements.q,h=e.querySelector(".card-list"),{cardList:w,cardContainer:_}=(0,a.CS)(h),E={top:document.getElementById("paginator-top"),bottom:document.getElementById("paginator-bottom")};Array.from(_.children).forEach((async e=>{const{id:t,service:n}=e.dataset;s.j&&await(0,o.t8)(t,n)&&e.classList.add("user-card--fav")})),e.addEventListener("click",(async e=>{const n=e.target,o=n.parentElement.classList.contains("paginator-button-ident");(n.classList.contains("paginator-button-ident")&&n.dataset&&n.dataset.value||o&&n.parentElement.dataset&&n.parentElement.dataset.value)&&(e.preventDefault(),d=Number(o?n.parentElement.dataset.value:n.dataset.value),window.location.hash="o="+d,y(u.value,m.value,f.value,v.value),await L(t,_,E,f.value))})),r.addEventListener("submit",(e=>e.preventDefault())),v.addEventListener("change",g(u,m,f,v,t,_,E)),v.addEventListener("keydown",p(g(u,m,f,v,t,_,E),300)),m.addEventListener("change",g(u,m,f,v,t,_,E)),f.addEventListener("change",g(u,m,f,v,t,_,E)),u.addEventListener("change",g(u,m,f,v,t,_,E)),await async function(e){try{const t=await i.J.api.creators();if(!t)return null;for(const e of t)e.parsedIndexed=1e3*e.indexed,e.parsedUpdated=1e3*e.updated,e.indexed=new Date(e.parsedIndexed).toISOString(),e.updated=new Date(e.parsedUpdated).toISOString();e.innerHTML="",c=t,l=t}catch(e){console.error(e)}}(n),g(u,m,f,v,t,_,E)(null),(0,a.gH)()}]],["updated",[async function(e){(0,a.gH)();const t=e.querySelector(".card-list"),{cardContainer:n}=(0,a.CS)(t);for await(const e of n.children){const{id:t,service:n}=e.dataset;s.j&&await(0,o.t8)(t,n)&&e.classList.add("user-card--fav")}}]],["upload",[async function(e){Array.from(document.getElementsByTagName("textarea")).forEach((e=>{e.setAttribute("style","height:"+e.scrollHeight+"px;overflow-y:hidden;"),e.addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),!1)})),new W.ZP({restrictions:{maxTotalFileSize:2147483648,maxNumberOfFiles:10,minNumberOfFiles:1}}).use(M.Z,{note:"Up to 10 files permitted.",fileManagerSelectionType:"both",target:"#upload",inline:!1,trigger:"#upload-button",theme:"dark"}).use(z.Z,{endpoint:"http://localhost:1080/files/",retryDelays:[0,1e3,3e3,5e3]}).use(R.Z,{resultName:"uppyResult",target:"#upload-form",submitOnSuccess:!1}).on("complete",(e=>{let{successful:t}=e;t.forEach((e=>{document.getElementById("file-list").innerHTML+=`<li>${e.meta.name}</li>`}))}))}]],["all-dms",[a.gH]],["favorites",[a.gH]],["file-hash-search",[function(){const e=document.getElementById("file-search"),t=document.getElementById("file"),n=document.getElementById("hash");e.addEventListener("submit",(async function(e){let o;e.preventDefault(),""!==t.value?o=await async function(e){const t=e.size,n=1048576;let o=0,a=new(K());for(;o<t;){const t=new Uint8Array(await e.slice(o,n+o).arrayBuffer());a.update(t),o+=n}return a.digest("hex")}(t.files[0]):""!==n.value?n.value.match(/[A-Fa-f0-9]{64}/)?o=n.value:alert("Invalid SHA256 hash"):alert("Neither file or hash provided"),o&&(window.location.search="?hash="+o)}))}]],["review-dms",[async function(){const e=document.getElementById("status");e.addEventListener("change",(async function(t){t.preventDefault();const n=new URL(window.location.href);n.searchParams.set("status",e.value),window.location.href=n.toString()})),await(0,O.s)(!0)}]],["moderator-creator-links",[function(){Array.from(document.querySelectorAll(".link-request-card")).forEach((e=>{e.querySelector(".control > .approve").addEventListener("click",(async t=>{await async function(e){let t=await fetch(`/creator_link_requests/${e}/approve`,{method:"POST"});await t.json()}(e.dataset.id),e.remove()})),e.querySelector(".control > .reject").addEventListener("click",(async t=>{await async function(e){let t=await fetch(`/creator_link_requests/${e}/reject`,{method:"POST"});await t.json()}(e.dataset.id),e.remove()}))}))}]]]))},3027:(e,t,n)=>{n.d(t,{CS:()=>r,M$:()=>u,Ho:()=>a,y4:()=>l,EK:()=>w,Oe:()=>d,Jd:()=>y,F7:()=>g,gH:()=>_,hJ:()=>p});var o=n(1823);function a(){return(0,o.L)("loading-icon")}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=e?function(e){const t=e.querySelector(".card-list__items"),n=e.querySelectorAll(".card-list__items > *");return{cardList:e,cardContainer:t,cardItems:Array.from(n)}}(e):function(){const e=(0,o.L)("card-list"),t=e?.querySelector(".card-list__items");return{cardList:e,cardContainer:t,cardItems:[]}}();let n;try{let e=document.cookie.split(";").reduce(((e,t)=>(e[t.split("=")[0].trim()]=decodeURIComponent(t.split("=")[1]),e)),{});n=parseInt(e?.thumbSize),n=isNaN(n)?void 0:n}catch(e){return t}var a;n||(a="thumbSize","180",399,document.cookie.split(";").find((e=>e.trim().startsWith(a+"=")))||function(e,t,n){const o=new Date;o.setTime(o.getTime()+344736e5);const a="expires="+o.toUTCString();document.cookie=e+"="+t+"; "+a+";path=/"}(a,"180"));let r=parseInt(n)===parseInt(180)?void 0:n,i=document.querySelector(".card-list__items");return i.parentNode.classList.contains("card-list--phone")||(window.addEventListener("resize",(()=>s(i,180,r))),s(i,180,r)),t}function s(e,t,n){let o=n||t;if(!n){let e=window.innerWidth-24,n=e/o;n<2&&1.5<n?o=e/2:n>12&&(o=1.5*t)}e.style.setProperty("--card-size",`${o}px`)}var i=n(744),c=n(3374);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e?function(e){const{id:t,service:n,user:o}=e.dataset;return{postCardElement:e,postID:t,service:n,userID:o}}(e):function(e){return{postCardElement:(0,o.L)("post-card"),postID:e.id,service:e.service,userID:e.user}}(t),a=n.postCardElement.querySelector(".post-card__view");if(a){const e=a.querySelector(".post-card__button"),t=n.postCardElement.querySelector(".post-card__link");e.addEventListener("click",function(e){return t=>{e.focus()}}(t))}return n}function d(e){const t=e||function(e,t,n,a,r){let s=i.VY.kemono.user.icon(e.service,e.id),l=i.VY.kemono.user.banner(e.service,e.id);const d=i.VY.kemono.user.profile(e.service,e.id);s=c.QA+s,l=c.Kq+l;const m=(0,o.L)("user-card");m.href=d,m.style.backgroundImage=`linear-gradient(rgb(0 0 0 / 50%), rgb(0 0 0 / 80%)), url(${l})`;const f=u(null,s,s,!0,"","user-card__user-icon"),v=m.querySelector(".user-card__icon"),p=m.querySelector(".user-card__name"),g=m.querySelector(".user-card__service"),h=m.querySelector(".user-card__count"),y=m.querySelector(".user-card__updated");if(v.appendChild(f),p.textContent=e.name,e.name.length>=24&&(p.title=e.name),g.textContent=i.Wq[e.service].title,g.style.backgroundColor=i.Wq[e.service].color,r&&m.classList.add(r),t?h.innerHTML=`<b>${e.favorited}</b> favorites`:h.remove(),n||a){const t=w(null,n?e.updated:e.indexed);y.appendChild(t)}else y.remove();return m}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]?arguments[5]:null);return t}function u(){let e=arguments.length>1?arguments[1]:void 0;const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||function(e,t,n,a,r){const s=(0,o.L)("fancy-image"),i=s.querySelector(".fancy-image__image");return i.src=e,i.srcset=t,i.alt=a,r&&s.classList.add(r),i.loading=n?"lazy":"eager",s}(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",arguments.length>5&&void 0!==arguments[5]?arguments[5]:null);return t}const m=document.getElementById("flying-tooltip"),[f,v]=m.children;function p(e,t){const{left:n,bottom:o}=e.getBoundingClientRect();m.classList.remove("tooltip--shown"),v.replaceWith(t),m.style.setProperty("--local-x",`${n}px`),m.style.setProperty("--local-y",`${o}px`),m.classList.add("tooltip--shown")}function g(e){return e||function(e){const t=(0,o.L)("tooltip__message tooltip__message--register");return t.querySelector(".tooltip__action").textContent=e,t}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")}f.addEventListener("click",(e=>{m.classList.remove("tooltip--shown")}));var h=n(8745);function y(e){const t=document.getElementById("burgor"),n=t.parentElement,o=document.querySelector(".backdrop"),a=document.querySelector(".content-wrapper"),r=e.querySelector(".close-sidebar"),s=function(t){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.classList.toggle("expanded"),e.classList.toggle("retracted"),o.classList.toggle("backdrop-hidden"),a.classList.toggle("shifted");const s=n.classList.toggle("sidebar-retracted");r&&window.innerWidth>1020&&localStorage.setItem("sidebar_state",s)};if("string"==typeof localStorage.getItem("sidebar_state")){const e="true"===localStorage.getItem("sidebar_state");window.innerWidth>1020&&e&&s()}if(window.addEventListener("resize",(()=>{if("string"!=typeof localStorage.getItem("sidebar_state"))return;const e="true"===localStorage.getItem("sidebar_state"),t=n.classList.contains("sidebar-retracted"),o=()=>{document.body.classList.add("transition-preload"),requestAnimationFrame((()=>setInterval((()=>document.body.classList.remove("transition-preload")))))};window.innerWidth<=1020?e&&t&&(o(),s(null,!1)):e&&!t&&(o(),s())})),t.addEventListener("click",s),o.addEventListener("click",s),r.addEventListener("click",s),h.j){const t=e.querySelector(".account"),o=t.querySelector(".login"),a=n.querySelector(".login"),r=t.querySelector(".register"),s=n.querySelector(".register"),i=t.querySelector(".favorites"),c=t.querySelector(".review_dms");o.classList.remove("login"),a.classList.remove("login"),a.classList.add("logout"),r.classList.remove("register"),s.classList.remove("register"),i.classList.remove("hidden"),c.classList.remove("hidden"),o.lastChild.textContent="Logout",o.firstElementChild.src="/static/menu/logout.svg",o.href="/account/logout",a.innerText="Logout",a.href="/account/logout",r.lastChild.textContent="Keys",r.firstElementChild.src="/static/menu/keys.svg",r.href="/account/keys",s.innerText="Favorites",s.href="/favorites";const l=e=>{e.preventDefault(),localStorage.removeItem("logged_in"),localStorage.removeItem("role"),localStorage.removeItem("favs"),localStorage.removeItem("post_favs"),location.href="/account/logout"};o.addEventListener("click",l),a.addEventListener("click",l)}else{const t=e.querySelector(".account-header"),n=document.createElement("div");n.className="global-sidebar-entry-item header",n.innerText="Account",n.prepend(t.firstElementChild),t.parentElement.replaceChild(n,t)}}function w(e,t){const n=e||function(e,t,n){const a=(0,o.L)("timestamp");return a.dateTime=e,n&&a.classList.add(n),a.textContent=e,a}(t,0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return n}function _(){document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowLeft":document.querySelector(".paginator .prev")?.click();break;case"ArrowRight":document.querySelector(".paginator .next")?.click()}}))}window.addEventListener("load",(()=>{document.body.classList.remove("transition-preload")}))},744:(e,t,n)=>{n.d(t,{sf:()=>a,_K:()=>r,VY:()=>i,Wq:()=>s,Q5:()=>c});const o={0:"Could not connect to server.",1:"Could not favorite post.",2:"Could not unfavorite post.",3:"Could not favorite artist.",4:"Could not unfavorite artist.",5:"There might already be a flag here.",6:"Could not retrieve the list of bans.",7:"Could not retrieve banned artist.",8:"Could not retrieve artists.",9:"Could not retrieve import logs."};class a extends Error{constructor(e){super(),this.code=String(e).padStart(3,"0"),this.message=`${this.code}: ${o[e]}`}}function r(e){Array.from(e).forEach((e=>{const t=e.closest("a");!t||t.classList.contains("user-header__profile")||t.classList.contains("user-card")||t.classList.contains("image-link")||t.classList.contains("global-sidebar-entry-item")||t.classList.add("image-link")}))}parseInt(document.documentElement.style.getPropertyValue("--duration-global"));const s={patreon:{title:"Patreon",color:"#fa5742",user:{profile:e=>`https://www.patreon.com/user?u=${e}`},post:{}},fanbox:{title:"Pixiv Fanbox",color:"#2c333c",user:{profile:e=>`https://www.pixiv.net/fanbox/creator/${e}`},post:{}},subscribestar:{title:"SubscribeStar",color:"#009688",user:{profile:e=>`https://subscribestar.adult/${e}`},post:{}},gumroad:{title:"Gumroad",color:"#2b9fa4",user:{profile:e=>`https://gumroad.com/${e}`},post:{}},discord:{title:"Discord",color:"#5165f6",user:{profile:e=>""},post:{}},dlsite:{title:"DLsite",color:"#052a83",user:{profile:e=>`https://www.dlsite.com/eng/circle/profile/=/maker_id/${e}`},post:{}},fantia:{title:"Fantia",color:"#e1097f",user:{profile:e=>`user_id: f"https://fantia.jp/fanclubs/${e}`},post:{}},boosty:{title:"Boosty",color:"#fd6035",user:{profile:e=>`https://boosty.to/${e}`},post:{}},afdian:{title:"Afdian",color:"#9169df",user:{profile:e=>""},post:{}},fansly:{title:"Fansly",color:"#2399f7",user:{profile:e=>`https://fansly.com/${e}`},post:{}},onlyfans:{title:"OnlyFans",color:"#008ccf",user:{profile:e=>`https://onlyfans.com/${e}`},post:{}},candfans:{title:"CandFans",color:"#e8486c",user:{profile:e=>`https://candfans.jp/${e}`},post:{}}},i={kemono:{title:"Kemono",user:{profile:(e,t)=>`/${e}/${"discord"===e?"server":"user"}/${t}`,icon:(e,t)=>`/icons/${e}/${t}`,banner:(e,t)=>`/banners/${e}/${t}`},post:{link:(e,t,n)=>`/${e}/user/${t}/post/${n}`}}};function c(e){return new Promise((t=>setTimeout(t,e)))}}},e=>{e.O(0,[216],(()=>(4558,e(e.s=4558)))),e.O()}]);